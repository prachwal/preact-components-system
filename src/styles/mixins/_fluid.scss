// Enhanced Mixins: Fluid Typography & Spacing
// Functions for generating fluid clamp() values

@use 'sass:math';
@use 'sass:meta';

// ============================================================================
// FLUID SIZE GENERATOR
// ============================================================================
// Generates clamp() for fluid scaling between viewport ranges
//
// @param {Number} $min-size - Minimum size (at min viewport)
// @param {Number} $max-size - Maximum size (at max viewport)
// @param {Number} $min-viewport [375px] - Minimum viewport width
// @param {Number} $max-viewport [1440px] - Maximum viewport width
// @returns {String} - CSS clamp() function
//
// Example:
//   font-size: fluid-size(16px, 24px);
//   // Output: clamp(1rem, 0.85rem + 0.75vw, 1.5rem)

@function strip-unit($number) {
  @if meta.type-of($number) == 'number' and not math.is-unitless($number) {
    @return math.div($number, $number * 0 + 1);
  }
  @return $number;
}

@function fluid-size($min-size, $max-size, $min-viewport: 375px, $max-viewport: 1440px) {
  // Strip units for calculation
  $min-size-unitless: strip-unit($min-size);
  $max-size-unitless: strip-unit($max-size);
  $min-viewport-unitless: strip-unit($min-viewport);
  $max-viewport-unitless: strip-unit($max-viewport);

  // Convert to rem for min/max (assuming 16px base)
  $min-rem: math.div($min-size-unitless, 16);
  $max-rem: math.div($max-size-unitless, 16);

  // Calculate slope and intercept
  $viewport-range: $max-viewport-unitless - $min-viewport-unitless;
  $size-range: $max-size-unitless - $min-size-unitless;

  $slope: math.div($size-range * 100, $viewport-range);
  $intercept-px: $min-size-unitless - ($slope * $min-viewport-unitless / 100);
  $intercept-rem: math.div($intercept-px, 16);

  @return clamp(#{$min-rem}rem, #{$intercept-rem}rem + #{$slope}vw, #{$max-rem}rem);
}

// ============================================================================
// FLUID SPACING MIXIN
// ============================================================================
// Apply fluid spacing to any CSS property
//
// @param {String} $property - CSS property (padding, margin, gap, etc.)
// @param {Number} $min-size - Minimum size
// @param {Number} $max-size - Maximum size
// @param {Number} $min-viewport [375px] - Minimum viewport
// @param {Number} $max-viewport [1440px] - Maximum viewport
//
// Example:
//   @include fluid-spacing(padding, 16px, 32px);
//   @include fluid-spacing(margin-bottom, 24px, 48px);

@mixin fluid-spacing($property, $min-size, $max-size, $min-viewport: 375px, $max-viewport: 1440px) {
  #{$property}: fluid-size($min-size, $max-size, $min-viewport, $max-viewport);
}

// ============================================================================
// FLUID TYPOGRAPHY MIXIN
// ============================================================================
// Complete fluid typography with size and line-height
//
// @param {Number} $min-font-size - Minimum font size
// @param {Number} $max-font-size - Maximum font size
// @param {Number} $min-line-height [1.5] - Minimum line height (unitless)
// @param {Number} $max-line-height [$min-line-height] - Maximum line height
// @param {Number} $min-viewport [375px] - Minimum viewport
// @param {Number} $max-viewport [1440px] - Maximum viewport
//
// Example:
//   @include fluid-typography(16px, 20px, 1.5, 1.6);

@mixin fluid-typography(
  $min-font-size,
  $max-font-size,
  $min-line-height: 1.5,
  $max-line-height: $min-line-height,
  $min-viewport: 375px,
  $max-viewport: 1440px
) {
  font-size: fluid-size($min-font-size, $max-font-size, $min-viewport, $max-viewport);

  @if $min-line-height != $max-line-height {
    // Fluid line-height (convert to px for calculation, but output unitless)
    $min-lh-px: strip-unit($min-font-size) * $min-line-height;
    $max-lh-px: strip-unit($max-font-size) * $max-line-height;
    $fluid-lh: fluid-size($min-lh-px * 1px, $max-lh-px * 1px, $min-viewport, $max-viewport);

    // Calculate unitless line-height by dividing by font-size
    line-height: calc(#{$fluid-lh} / 1em);
  } @else {
    line-height: $min-line-height;
  }
}

// ============================================================================
// FLUID CONTAINER MIXIN
// ============================================================================
// Create fluid container with padding
//
// @param {Number} $min-padding [16px] - Minimum side padding
// @param {Number} $max-padding [32px] - Maximum side padding
// @param {Number} $max-width [null] - Maximum container width
//
// Example:
//   @include fluid-container(16px, 48px, 1200px);

@mixin fluid-container($min-padding: 16px, $max-padding: 32px, $max-width: null) {
  width: 100%;
  margin-left: auto;
  margin-right: auto;
  padding-left: fluid-size($min-padding, $max-padding);
  padding-right: fluid-size($min-padding, $max-padding);

  @if $max-width {
    max-width: $max-width;
  }
}

// ============================================================================
// FLUID GAP MIXIN (for flexbox/grid)
// ============================================================================
// Apply fluid gap to flex or grid containers
//
// @param {Number} $min-gap - Minimum gap size
// @param {Number} $max-gap - Maximum gap size
// @param {String} $direction [both] - 'row', 'column', or 'both'
//
// Example:
//   @include fluid-gap(16px, 32px);
//   @include fluid-gap(8px, 16px, 'column');

@mixin fluid-gap($min-gap, $max-gap, $direction: 'both') {
  $fluid-value: fluid-size($min-gap, $max-gap);

  @if $direction == 'row' {
    column-gap: $fluid-value;
  } @else if $direction == 'column' {
    row-gap: $fluid-value;
  } @else {
    gap: $fluid-value;
  }
}

// ============================================================================
// FLUID BETWEEN MIXIN (space-between items)
// ============================================================================
// Add fluid margin between child elements
//
// @param {Number} $min-space - Minimum space between items
// @param {Number} $max-space - Maximum space between items
// @param {String} $selector [*] - Child selector
// @param {String} $direction [vertical] - 'vertical' or 'horizontal'
//
// Example:
//   @include fluid-between(16px, 32px, '> *', 'vertical');

@mixin fluid-between($min-space, $max-space, $selector: '*', $direction: 'vertical') {
  $property: if($direction == 'vertical', 'margin-top', 'margin-left');

  #{$selector} + #{$selector} {
    #{$property}: fluid-size($min-space, $max-space);
  }
}
